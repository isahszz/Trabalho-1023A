<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Cadastro</title>
</head>

<body>
    <form onsubmit="event.preventDefault(); trataForm()">
        <label for="id">ID</label>
        <input type="number" id="id" name="id" min="1" max="500" required>

        <label for="nome">Nome</label>
        <input type="text" id="nome" name="nome" required>

        <label for="preco">Preço</label>
        <input type="number" id="preco" name="preco" min="0" max="1000" step="0.01" required>

        <label for="descricao">Descrição</label>
        <input type="text" id="descricao" name="descricao" required>

        <input type="submit" value="Cadastrar">
    </form>

    <script>
        async function trataForm() {
            const id = document.getElementById("id").value;
            const nome = document.getElementById("nome").value;
            const preco = document.getElementById("preco").value;
            const descricao = document.getElementById("descricao").value;

            const objPerfume = {
                id,
                nome,
                preco,
                descricao
            };

            try {
                const resposta = await fetch("http://localhost:8000/perfumes", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(objPerfume)
                });

                if (resposta.ok) {
                    alert("Perfume cadastrado com sucesso!");
                } else if (resposta.status === 400) {
                    const dados = await resposta.json();
                    alert(`Erro do lado do backend:\n${dados.mensagem}`);
                } else {
                    alert(`Erro inesperado: Código ${resposta.status}`);
                }
            } catch (erro) {
                alert("Erro na requisição do FETCH.\nVocê ligou o backend com 'npm run dev'?");
                console.error(erro);
            }
        }
    </script>
</body>

</html>
